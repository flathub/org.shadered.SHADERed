app-id: org.shadered.SHADERed
runtime: org.freedesktop.Platform
runtime-version: "24.08"
sdk: org.freedesktop.Sdk
command: shadered
rename-desktop-file: shadered.desktop
rename-icon: shadered

finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
  - --filesystem=home
  - --device=all

cleanup:
  - "*.a"
  - "*.cmake"
  - "*.hpp"
  - "*.h"
  - "*.inl"

modules:

  - shared-modules/glew/glew.json

  - shared-modules/glu/glu-9.json

  - name: glm
    buildsystem: cmake-ninja
    cleanup: ["*"]
    no-make-install: true
    post-install:
      - install -d ${FLATPAK_DEST}/include
      - cp -R glm ${FLATPAK_DEST}/include
    sources:
      - type: archive
        url: https://github.com/g-truc/glm/archive/refs/tags/1.0.0.tar.gz
        sha256: e51f6c89ff33b7cfb19daafb215f293d106cd900f8d681b9b1295312ccadbd23

  - name: SFML
    buildsystem: cmake-ninja
    config-opts:
      - -DSFML_INSTALL_PKGCONFIG_FILES=TRUE
    sources:
      - type: archive
        url: https://github.com/SFML/SFML/archive/refs/tags/2.6.2.tar.gz
        sha256: 15ff4d608a018f287c6a885db0a2da86ea389e516d2323629e4d4407a7ce047f

  - name: shadered
    buildsystem: cmake-ninja
    config-opts:
      # Required for the Flatpak build to succeed.
      - -DDONT_LINK_FILESYSTEM=1
    build-commands:
      - install -Dm644 $FLATPAK_ID.metainfo.xml -t /app/share/metainfo/
    sources:
      - type: git
        url: https://github.com/dfranx/SHADERed.git
        tag: v1.5.6
        commit: d118369cbc5f18db3596e318c92557760ef0b466
      - type: patch
        path: fix-missing-std-includes.patch
      # AppStream metadata wasn't updated, so provide it with related patches.
      - type: file
        path: org.shadered.SHADERed.metainfo.xml
